<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>NumIn</title>
  </head>
  <body>
    <input type="text" id="ipt">
  </body>
</html>
<script type="text/javascript">
  // 让数字字符进行数字的运算，并返回结果
  function arithmeticByStr(v1,v2){
    v1=v1+''; v2=v2+'';
    let ret='';
    // 对齐
    let gap=v1.length-v2.length;
    let i=(gap>0?v1.length:v2.length)-1;
    // 偏移补偿
    let ag=0,bg=0;
    gap>0?bg=gap:ag=-gap;

    let dc=0; // 进数
    while (v1[i-ag]||v2[i-bg]){
      let a=v1[i-ag]?v1[i-ag]*1:0,b=v2[i-bg]?v2[i-bg]*1:0;
      // 本数
      let os=(a+b+dc)%10;
      ret=os+ret;
      dc=(a+b+dc)/10>>0;
      i--;
    }
    // 最后进数
    if(dc){
      ret=dc+ret;
    }
    return ret;
  }
  console.log(arithmeticByStr('89999','100011'));
  let ipt=document.querySelector('#ipt');
  ipt.addEventListener('keydown',function (e){
    let {keyCode: kc,ctrlKey: ck,shiftKey: sk,key}=e;
    let {value: v}=this;
    let aNav={37: -1,39: 1}[kc];
    let nav={Home: 1,End: 1}[key];
    let step={38: 1,40: -1}[kc];
    let num=/[0-9]/.test(key);
    let dot=!/\./.test(v)&&key=='.';
    let del={Backspace: 1,Delete: 1}[key];

    if(ck){
      step*=10;
    }
    if(sk){
      step*=0.1;
    }

    if(aNav||nav||num||dot||del||(ck&&!step)){

    }else if(v===''&&key=='-'){

    }else{
      // 取反
      if(key=='-'&&v!=='-'){
        let ss=this.selectionStart;
        let se=this.selectionEnd;
        if(/\-/.test(v.substring(ss,se))&&(ss-se)*(ss-se)===1){
          this.setSelectionRange(se,se);
        }else{
          if(/\-/.test(v)){
            this.value=v.replace('-','');
            ss--; se--;
          }else{
            this.value='-'+v;
            ss++; se++;
          }
          this.setSelectionRange(ss,se);
        }
      }
      if(step){
        this.value=arithmeticByStr(v,step);
        // --------------------------------
        // 待完善
        // --------------------------------
      }
      e.preventDefault();
    }
  })
  ipt.addEventListener('blur',function (e){
    if(this.value=='-'){
      this.value='-0';
    }
  })
  ipt.addEventListener('focus',function (e){
    if(this.value=='-0'){
      this.value='-';
    }
  })
  ipt.addEventListener('paste',function (e){
    e.preventDefault();
    let me=this;
    e.clipboardData.items[0].getAsString(function (s){
      let nv=s.replace(/[^0-9\-]/g,'');
      let v=me.value;
      let pos=me.selectionStart;
      let posE=me.selectionEnd;
      let mvbf=v.substring(0,pos);
      let mvaf=v.substring(posE);
      let neg='';
      // 只有当原来的值为正时并且粘贴值为负时，才添负号
      if(!/\-/.test(mvbf+mvaf)&&/\-/.test(nv)){
        neg='-';
      }
      nv=nv.replace('-','');
      // 当你试图把内容复制到负号前面时，它会先将负号提取出来然后合并再在合并后最前面添负号
      if(/\-/.test(mvaf)){
        mvaf=mvaf.replace('-','');
        neg='-';
      }
      me.value=neg+mvbf+nv+mvaf;
      let endP=pos+(nv+'').length+neg.length;
      me.setSelectionRange(endP,endP);
    });
  });
  ipt.focus();
</script>
