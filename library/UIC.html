<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>UIC</title>
    <link rel="stylesheet" href="UIC.css">
    <script src="../lib/init.js" charset="utf-8"></script>
    <script src="../lib/DOMProxer.js" charset="utf-8"></script>
    <script type="text/javascript">addEventListener('load',()=>{

      let DProxer=getLib('DOMProxer');

      let UCPT_CT=0;
      // 元素基本组件
      const UCpt=function (UCTp,dom){
        DProxer.call(this,dom||'div',{
          className: UCTp,
        });
        // 元素为应用程序基本单元，UCTp将作为辨别不同元素的重要凭证
        let uct=UCTp;

        this.getUCType=function (){
          return uct;
        }

      }; UCpt.cc('UCpt',DProxer);

      const P=function (ctn){ UCpt.call(this,'p','p');
        this.atrs({innerHTML: ctn});
      }; P.cc('P',UCpt);

      // 输入组件基类
      const Input=function (iptTp,dT){
        UCpt.call(this,'input',dT||'input');
        let iptType=iptTp;
        let isFocus=false;
        this.getIptType=function (){
          return iptType;
        }
        let value='';
        this.value=function (v){
          if(typeof v!=='undefined'){
            value=v;
            return this;
          }
          return value;
        }
      }; Input.cc('Input',UCpt);

      // 输入框
      let TextIn=function (hdp,sbT){
        Input.call(this,'input');
        this.atrs({type: sbT||'text'});
        let filter=()=>true;
        this.filter=function (fn){
          if(typeof fn!=='undefined'){
            if(typeof fn==='function'){
              filter=fn;
            }
            return this;
          }
          return filter;
        }
        let value=this.value;
        this.value=function (v){
          if(filter(v)){
            this.dom().value=value();
            return value(v);
          }
        }

        // 当你试图阻止默认事件时应该调用该方法
        this.preventDefaultFn=(e)=>false;

        let me=this;

        this.classList().add('textIn');
        this.atrs({type: 'text',placeholder: hdp});

        this.on('keydown',function (e){
          if(filter.call(this,e)){
            return true;
          }

          return me.preventDefaultFn(e);
        })

        this.addEvent('input',function (){
          value(this.value);
        })
      }; TextIn.cc('TextIn',Input);

      // 完美的数字输入框
      const NumIn=function (phd){ TextIn.call(this,phd,'number');
        this.dom().maxLength=2;
        this.backup('maxL',this.dom().maxLength);
        this.filter(function (e){
          if(typeof e==='object'){
            let cdtr=/[0-9]/.test(e.key)||{Backspace:1}[e.key]||(e.keyCode>36&&e.keyCode<41);
            if(cdtr){
              return true;
            }
          }else if(typeof e==='number'&&(e+'').length<=this.dom().maxLength){
            return true;
          }
        });
        this.addEvent('keydown',function (e){
          let stepv=0;
          let {ctrlKey: ck,shiftKey: sk,keyCode: kc}=e;
          let {value: v}=this;
          let maxL=numIn1.rec('maxL');
          stepv=ck?10:sk?0.1:1;

          let rv=kc==40&&((v*1-stepv).toFixed(0))||kc==38&&((v*1+stepv).toFixed(0));
          // 否是溢出
          let ntOrf=(rv+0)&&(Math.abs(rv*1)+'').length<=maxL;

          if(maxL<0){
            ntOrf=true;
          }

          // 溢出处理
          if(!ntOrf&&typeof rv!=='boolean'){
            let maxV=Math.pow(10,maxL)-1;
            if(rv<0){
              this.value=-maxV;
            }else{
              this.value=maxV;
            }
          }

          // 给负号留出一个空间
          if(e.key=='-'){
            if(/-/.test(this.value)&&this.value[0]!=='-'){
              this.value=this.value.replace(/-/,'');
            }else{
              this.value=-this.value;
            }
          }
          if(this.value<0){
            !ntOrf&&(this.maxLength=numIn1.rec('maxL')+1);
          }else{
            !ntOrf&&(this.maxLength=numIn1.rec('maxL'));
          }
          ntOrf&&rv&&(this.value=rv);
        })
      }; NumIn.cc('NumIn',TextIn);

      // 按钮
      let Button=function (str){ Input.call(this,'input');
        this.classList().add('button');
        this.atrs({value: str, type: 'button'});
      }; Button.cc('Button',Input);


      let root=new UCpt('root',document.querySelector('body'));
      let frame1=new UCpt('frame').style({flexGrow: '1'}).addOn(root);
      let p1=new P('这是第一个frame').addOn(frame1);
      let p12=new P('我是一只羊').addOn(frame1);

      let frame2=new UCpt('frame').style({flexGrow: '1'});
      let p2=new P('这是第二个frame').addOn(frame2);
      let p22=new P('我现在已经飙到极限了。。。').addOn(frame2);

      let frame3=new UCpt('frame').style({flexGrow: '1'});
      let p3=new P('这是第三个frame').addOn(frame3);
      let p32=new P('摇~摇~晃~晃，你是想摇，还是想晃？').addOn(frame3);


      let ctrlFrame=new UCpt('frame').atrs({id: 'ctrlFrame'}).addOn(root);
      let btn1=new Button('go');

      let frames=[frame1,frame2,frame3];


      // frame id
      let numIn1=new NumIn('?').style({
        width: '2em',
      }).addOn(ctrlFrame);

      btn1.addOn(ctrlFrame);

      let ct=0;
      btn1.addEvent('click',function (e){
        root.rmCld(frames[ct]);
        ct=ct+1<frames.length?ct+1:0;
        root.addTo(frames[ct],ctrlFrame);
      })

      btn1.dom().focus();
    })</script>
  </head>
  <body>
  </body>
</html>
