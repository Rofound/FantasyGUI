<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>prototype</title>
    <style media="screen">
      canvas{
        position: absolute;
        left: 0px;
        top: 0px;
        background: #333;
      }
    </style>
  </head>
  <body>
    <canvas id="cvs"></canvas>
  </body>
</html>
<script type="text/javascript">
  var body=document.querySelector('body');
  var cvs=document.querySelector('#cvs')
  var ctx=cvs.getContext('2d');
  var init=function (){
    cvs.width=innerWidth
    cvs.height=innerHeight
  }
  onresize=init
  init()

  // 图像放大算法

  var img=document.createElement('img');
  img.src="pebble-light.jpg";
  var imgData;
  img.onload=function (){
    ctx.drawImage(img,0,0,100,100);
    imgData=ctx.getImageData(0,0,100,100);

  }

  function change(){
    if(!imgData) return;
    // 中心点
    var cx=150,cy=150;
    for(var i=0;i<imgData.data.length;i+=4){
      // 以自己为中心缩放
      // 自己的横坐标
      var _x=100+i%100;
      // 相对于中心的距离
      var dx=cx-_x;

      imgData.data[i]=100+(dx-150);
      imgData.data[i+1]*=1;
      imgData.data[i+2]*=1;
      imgData.data[i+3]*=1;
    }
  }

  var mx=0,my=0;

  addEventListener("mousemove",function (e){
    mx=e.clientX;
    my=e.clientY;
  });

  setInterval(function (){
    ctx.clearRect(0,0,innerWidth,innerHeight);

    ctx.save();
    ctx.fillStyle="#f00";
    ctx.arc(100,100,10,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    ctx.save();
    ctx.drawImage(img,100,100,100,100);

    change();

    ctx.putImageData(imgData,500,100);
    ctx.restore();
  },30);
</script>
